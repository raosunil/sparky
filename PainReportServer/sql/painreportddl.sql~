-- ----------------------------------------------
-- This file is the DDL for the PainReport app.
-- For now it does not store the question id and
-- text, and their component answers. These are
-- taken from the survey results when uploaded.
--
-- KG 9/30/13
-- ----------------------------------------------

-- ----------------------------------------------
-- DDL Statements for sequences
-- ----------------------------------------------

CREATE SEQUENCE "APP"."PAINREPORT_SEQ"
    AS INTEGER
    START WITH -2147483648
    INCREMENT BY 1
    MAXVALUE 9999999
    MINVALUE -2147483648
    CYCLE
;

-- ----------------------------------------------
-- DDL Statements for tables
-- ----------------------------------------------

--CREATE TABLE "APP"."QUESTION" ("ID" VARCHAR(32) NOT NULL, "TEXT" VARCHAR(256) NOT NULL);
--CREATE TABLE "APP"."ANSWER_COMPONENT" ("ID" VARCHAR(32) NOT NULL, "TYPE" INTEGER, "QUESTION_ID" VARCHAR(32) NOT NULL);
CREATE TABLE "APP"."PATIENT" ("PIN" CHAR(4) NOT NULL, "NEXT_READING" TIMESTAMP, "IS_ANDROID" BOOLEAN, "OS_VERSION" INTEGER, "DATE_STARTED" TIMESTAMP, "DATE_COMPLETED" TIMESTAMP);
CREATE TABLE "APP"."SURVEY_RESULT" ("PATIENT_ID" CHAR(4) NOT NULL, "DATE_TIME" TIMESTAMP NOT NULL);
CREATE TABLE "APP"."SURVEY_RESULT_ANSWER" ("ANSWER_COMPONENT_ID" VARCHAR(32) NOT NULL, "QUESTION_ID" VARCHAR(32) NOT NULL, "PATIENT_ID" CHAR(4) NOT NULL, "DATE_TIME" TIMESTAMP NOT NULL, "VALUE" VARCHAR(2048) NOT NULL);
CREATE TABLE "APP"."EVENT" ("EVENT_ID" INTEGER NOT NULL, "PATIENT_ID" CHAR(4), "EVENTTYPE" VARCHAR(16) NOT NULL, "EVENTVALUE" VARCHAR(1024) NOT NULL, "EVENTTIME" TIMESTAMP NOT NULL);

-- ----------------------------------------------
-- DDL Statements for keys
-- ----------------------------------------------

-- primary/unique
--ALTER TABLE "APP"."QUESTION" ADD CONSTRAINT "QUESTION_PK" PRIMARY KEY ("ID");
--ALTER TABLE "APP"."ANSWER_COMPONENT" ADD CONSTRAINT "ANSWER_COMPONENT_PK" PRIMARY KEY ("ID", "QUESTION_ID");
ALTER TABLE "APP"."PATIENT" ADD CONSTRAINT "PATIENT_PK" PRIMARY KEY ("PIN");
ALTER TABLE "APP"."SURVEY_RESULT" ADD CONSTRAINT "SURVEY_RESULT_PK" PRIMARY KEY ("PATIENT_ID", "DATE_TIME");
ALTER TABLE "APP"."SURVEY_RESULT_ANSWER" ADD CONSTRAINT "SURVEY_RESULT_ANSWER" PRIMARY KEY ("ANSWER_COMPONENT_ID", "QUESTION_ID", "PATIENT_ID", "DATE_TIME");
ALTER TABLE "APP"."EVENT" add constraint "EVENT_PK" primary key ("EVENT_ID");

-- foreign
--ALTER TABLE "APP"."ANSWER_COMPONENT" ADD CONSTRAINT "QUESTION_FK" FOREIGN KEY ("QUESTION_ID") REFERENCES "APP"."QUESTION" ("ID") ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE "APP"."SURVEY_RESULT" ADD CONSTRAINT "PATIENT_FK" FOREIGN KEY ("PATIENT_ID") REFERENCES "APP"."PATIENT" ("PIN") ON DELETE NO ACTION ON UPDATE NO ACTION;
ALTER TABLE "APP"."SURVEY_RESULT_ANSWER" ADD CONSTRAINT "SURVEY_RESULT_FK" FOREIGN KEY ("PATIENT_ID","DATE_TIME") REFERENCES "APP"."SURVEY_RESULT" ("PATIENT_ID","DATE_TIME") ON DELETE NO ACTION ON UPDATE NO ACTION;
--ALTER TABLE "APP"."SURVEY_RESULT_ANSWER" ADD CONSTRAINT "ANSWER_COMPONENT_FK" FOREIGN KEY ("ANSWER_COMPONENT_ID","QUESTION_ID") REFERENCES "APP"."ANSWER_COMPONENT" ("ID","QUESTION_ID") ON DELETE NO ACTION ON UPDATE NO ACTION;

